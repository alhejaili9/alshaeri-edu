<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÙƒØ´Ù Ø±ØµØ¯ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª - Ù…Ø¯Ø§Ø±Ø³ Ø§Ù„Ø¹Ù‚ÙŠÙ‚</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        /* Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ØªØµÙÙŠØ± Ø§Ù„Ù‡ÙˆØ§Ù…Ø´ Ù„Ù…Ù†Ø¹ Ø¸Ù‡ÙˆØ± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØµÙØ­ */
        @page { 
            size: A4; 
            margin: 0; 
        }
        
        body { font-family: 'Traditional Arabic', serif; background-color: #e0e0e0; margin: 0; padding: 20px 0; -webkit-print-color-adjust: exact; font-size: 18px; }
        
        .container { 
            background-color: #fff; width: 210mm; min-height: 297mm; 
            margin: 0 auto; padding: 10mm 15mm; 
            box-shadow: 0 0 20px rgba(0,0,0,0.3); box-sizing: border-box; 
            border: 6px double #333; outline: 2px solid #333; outline-offset: -12px;
            display: flex; flex-direction: column;
        }

        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; padding-bottom: 5px; border-bottom: 2px solid #333; }
        .header-right { text-align: center; line-height: 1.3; font-weight: bold; font-size: 17px; width: 40%; }
        .header-left { display: flex; gap: 8px; align-items: center; width: 60%; justify-content: flex-end; }
        .logo-box { width: 60px; height: 60px; display: flex; align-items: center; justify-content: center; }
        .logo-box img { max-width: 100%; max-height: 100%; object-fit: contain; }
        .main-title { text-align: center; font-size: 24px; font-weight: bold; text-decoration: underline; margin: 10px 0; }
        
        .info-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; background: #f9f9f9; padding: 10px; border: 1px solid #ddd; margin-bottom: 15px; }
        .info-item { display: flex; align-items: center; gap: 10px; font-weight: bold; }
        
        select, input { font-family: 'Traditional Arabic'; font-size: 17px; padding: 2px; border: 1px solid #ccc; background: white; outline: none; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 10px; table-layout: fixed; }
        table, th, td { border: 1px solid #000; }
        th { background: #f2f2f2; padding: 8px; font-size: 16px; }
        td { padding: 4px; text-align: center; }
        
        .student-name-input { text-align: right; padding-right: 5px; width: 95%; border: none; font-family: inherit; font-size: 18px; background: transparent; }
        
        .toolbar { width: 210mm; margin: 0 auto 10px auto; display: flex; gap: 5px; flex-wrap: wrap; justify-content: center; align-items: center; }
        .btn { padding: 6px 12px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; color: white; font-family: 'Tajawal'; font-size: 13px; }
        .btn-print { background: #27ae60; }
        .btn-excel { background: #2c3e50; }
        .btn-sort { background: #8e44ad; }

        /* Ø³ØªØ§ÙŠÙ„ Ø®ÙŠØ§Ø± Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ÙØµÙ„ */
        .toggle-label { font-size: 13px; font-weight: bold; cursor: pointer; display: flex; align-items: center; gap: 5px; background: #fff; padding: 4px 8px; border-radius: 4px; border: 1px solid #ccc; }
        
        .footer-sigs { 
            margin-top: 30px; 
            padding-top: 10px; 
            display: flex; 
            justify-content: space-between; 
            align-items: flex-start;
            width: 100%;
            box-sizing: border-box;
            page-break-inside: avoid; 
        }
        .sig-box { 
            width: 23%; 
            display: flex; 
            flex-direction: column; 
            gap: 35px; 
            text-align: center;
        }
        .sig-title-input { border: none; font-weight: bold; text-align: center; font-size: 17px; background: transparent; width: 100%; }
        .sig-name-input { border: none; border-bottom: 1px dotted #000; text-align: center; font-size: 16px; background: transparent; width: 100%; }
        
        @media print { 
            .toolbar, .btn-remove { display: none !important; } 
            body { 
                background: white; 
                padding: 15mm 0 0 0; /* Ù…Ø³Ø§ÙØ© Ø¹Ù„ÙˆÙŠØ© Ø¨Ø¯ÙŠÙ„Ø© Ù„Ù„Ù‡ÙˆØ§Ù…Ø´ */
            } 
            .container { 
                box-shadow: none; 
                margin: 0 auto; 
                width: 100%; 
                min-height: auto; 
                border: none !important; 
                outline: none !important;
                padding: 0 15mm;
            }
            thead { display: table-header-group; } 
            tr { page-break-inside: avoid; } 
            select, input { border: none !important; -webkit-appearance: none; appearance: none; color: black; }
            .sig-name-input { border-bottom: none !important; }
            .info-grid { background: white !important; border: 1px solid #000; }
        }
    </style>
</head>
<body>
<div class="toolbar">
    <button class="btn btn-print" onclick="window.print()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
    <button class="btn btn-excel" onclick="document.getElementById('excel_file').click()">ğŸ“Š Ø§Ø³ØªÙŠØ±Ø§Ø¯ Excel</button>
    <input type="file" id="excel_file" style="display:none;" accept=".xlsx, .xls" onchange="importExcel(event)">
    <button class="btn btn-sort" onclick="sortNames('asc')">Ø£-ÙŠ</button>
    <button class="btn btn-sort" onclick="sortNames('desc')">ÙŠ-Ø£</button>
    <button class="btn btn-sort" onclick="sortGrades('desc')">Ø§Ù„Ø£Ø¹Ù„Ù‰ Ø¯Ø±Ø¬Ø©</button>
    <button class="btn btn-sort" onclick="sortGrades('asc')">Ø§Ù„Ø£Ù‚Ù„ Ø¯Ø±Ø¬Ø©</button>
    <button class="btn btn-print" style="background:#2980b9" onclick="addRow()">â• Ø¥Ø¶Ø§ÙØ© ÙŠØ¯ÙˆÙŠ</button>
    <label class="toggle-label">
        <input type="checkbox" checked onchange="document.getElementById('class-item').style.display = this.checked ? 'flex' : 'none'"> Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ÙØµÙ„
    </label>
</div>

<div class="container">
    <header>
        <div class="header-right"><div>Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</div><div>ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…</div><div>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ… Ø¨Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù†ÙˆØ±Ø©</div><div>Ù…Ø¯Ø§Ø±Ø³ Ø§Ù„Ø¹Ù‚ÙŠÙ‚ Ø§Ù„Ø£Ù‡Ù„ÙŠØ©</div></div>
        <div class="header-left">
            <div class="logo-box"><img src="ministry-logo.png" alt="ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…"></div>
            <div class="logo-box"><img src="aqeeq_logo.png" alt="Ù…Ø¯Ø§Ø±Ø³ Ø§Ù„Ø¹Ù‚ÙŠÙ‚"></div>
        </div>
    </header>
    <div class="main-title">ÙƒØ´Ù Ø±ØµØ¯ Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨</div>
    <div class="info-grid">
        <div class="info-item">Ø§Ù„Ù…Ø§Ø¯Ø©: <select id="subject-list"></select></div>
        <div class="info-item">Ø§Ù„ØµÙ: <select><option>Ø£ÙˆÙ„ Ù…ØªÙˆØ³Ø·</option><option>Ø«Ø§Ù†ÙŠ Ù…ØªÙˆØ³Ø·</option><option>Ø«Ø§Ù„Ø« Ù…ØªÙˆØ³Ø·</option><option>Ø£ÙˆÙ„ Ø«Ø§Ù†ÙˆÙŠ</option><option>Ø«Ø§Ù†ÙŠ Ø«Ø§Ù†ÙˆÙŠ</option><option>Ø«Ø§Ù„Ø« Ø«Ø§Ù†ÙˆÙŠ</option></select></div>
        <div class="info-item" id="class-item">Ø§Ù„ÙØµÙ„: <select id="class-num"></select></div>
        <div class="info-item">Ø§Ù„ØªØ§Ø±ÙŠØ®: <select id="h-day"></select> <select id="h-month"></select> <select id="h-year"></select></div>
        <div class="info-item">Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø¹Ø¸Ù…Ù‰: <select id="max-grade-list"></select></div>
        <div class="info-item">Ù†ÙˆØ¹ Ø§Ù„Ø±ØµØ¯: <select id="type-list" onchange="checkType(this)"><option>Ø§Ø®ØªØ¨Ø§Ø± ÙØªØ±ÙŠ</option><option>Ø¹Ù…Ù„ÙŠ</option><option selected>Ù†Ø¸Ø±ÙŠ Ù†Ù‡Ø§Ø¦ÙŠ</option><option>Ù…Ù‚Ø§Ù„ÙŠ Ù†Ù‡Ø§Ø¦ÙŠ</option><option value="custom">Ø¥Ø¯Ø®Ø§Ù„ ÙŠØ¯ÙˆÙŠ...</option></select> <input type="text" id="custom-type" style="display:none; width:100px; margin-right:5px;" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ù†ÙˆØ¹"></div>
    </div>
    <table id="mainTable">
        <thead>
            <tr>
                <th style="width: 40px;">Ù…</th>
                <th>Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</th>
                <th style="width: 120px;">Ø§Ù„Ø¯Ø±Ø¬Ø©</th>
                <th class="btn-remove" style="width: 40px;">Ø­Ø°Ù</th>
            </tr>
        </thead>
        <tbody id="grades-table"></tbody>
    </table>

    <div class="footer-sigs">
        <div class="sig-box">
            <input type="text" class="sig-title-input" value="Ø§Ù„Ù…ØµØ­Ø­">
            <input type="text" class="sig-name-input" placeholder="Ø§Ù„Ø§Ø³Ù… Ø±Ø¨Ø§Ø¹ÙŠØ§Ù‹">
        </div>
        <div class="sig-box">
            <input type="text" class="sig-title-input" value="Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹">
            <input type="text" class="sig-name-input" placeholder="Ø§Ù„Ø§Ø³Ù… Ø±Ø¨Ø§Ø¹ÙŠØ§Ù‹">
        </div>
        <div class="sig-box">
            <input type="text" class="sig-title-input" value="Ø§Ù„Ù…Ø¯Ù‚Ù‚">
            <input type="text" class="sig-name-input" placeholder="Ø§Ù„Ø§Ø³Ù… Ø±Ø¨Ø§Ø¹ÙŠØ§Ù‹">
        </div>
        <div class="sig-box">
            <input type="text" class="sig-title-input" value="Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¯Ø±Ø³Ø©">
            <input type="text" class="sig-name-input" placeholder="Ø§Ù„Ø§Ø³Ù… Ø±Ø¨Ø§Ø¹ÙŠØ§Ù‹">
        </div>
    </div>
</div>

<script>
    function toAr(num) { const id=['Ù ','Ù¡','Ù¢','Ù£','Ù¤','Ù¥','Ù¦','Ù§','Ù¨','Ù©']; return num.toString().replace(/[0-9]/g, w=>id[+w]); }
    function toEn(num) { const id={'Ù ':0,'Ù¡':1,'Ù¢':2,'Ù£':3,'Ù¤':4,'Ù¥':5,'Ù¦':6,'Ù§':7,'Ù¨':8,'Ù©':9}; return num.toString().replace(/[Ù -Ù©]/g, w=>id[w]); }
    
    const dSel=document.getElementById('h-day'); for(let i=1;i<=30;i++) dSel.innerHTML+=`<option>${toAr(i)}</option>`;
    const hijriMonths=["Ù…Ø­Ø±Ù…","ØµÙØ±","Ø±Ø¨ÙŠØ¹ Ø§Ù„Ø£ÙˆÙ„","Ø±Ø¨ÙŠØ¹ Ø§Ù„Ø¢Ø®Ø±","Ø¬Ù…Ø§Ø¯Ù‰ Ø§Ù„Ø£ÙˆÙ„Ù‰","Ø¬Ù…Ø§Ø¯Ù‰ Ø§Ù„Ø¢Ø®Ø±Ø©","Ø±Ø¬Ø¨","Ø´Ø¹Ø¨Ø§Ù†","Ø±Ù…Ø¶Ø§Ù†","Ø´ÙˆØ§Ù„","Ø°Ùˆ Ø§Ù„Ù‚Ø¹Ø¯Ø©","Ø°Ùˆ Ø§Ù„Ø­Ø¬Ø©"];
    const mSel=document.getElementById('h-month'); hijriMonths.forEach(m=>mSel.innerHTML+=`<option>${m}</option>`);
    const ySel=document.getElementById('h-year'); for(let i=1447;i<=1455;i++) ySel.innerHTML+=`<option>${toAr(i)}Ù‡Ù€</option>`;
    const cSel=document.getElementById('class-num'); for(let i=1;i<=6;i++) cSel.innerHTML+=`<option>${toAr(i)}</option>`;
    
    const subjects = ["Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…", "Ø§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©", "Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©", "Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª", "Ø§Ù„Ø¹Ù„ÙˆÙ…", "Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©", "Ø§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©", "Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„Ø±Ù‚Ù…ÙŠØ©", "Ø§Ù„ØªÙÙƒÙŠØ± Ø§Ù„Ù†Ø§Ù‚Ø¯", "Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡", "Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡", "Ø§Ù„Ø£Ø­ÙŠØ§Ø¡", "Ø§Ù„ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ø±Ù‚Ù…ÙŠØ©"];
    const sSel=document.getElementById('subject-list'); subjects.forEach(s=>sSel.innerHTML+=`<option>${s}</option>`);
    const gSel=document.getElementById('max-grade-list'); for(let i=1;i<=100;i++) gSel.innerHTML+=`<option ${i===100?'selected':''}>${toAr(i)}</option>`;

    function checkType(s) { document.getElementById('custom-type').style.display = (s.value === "custom") ? "inline-block" : "none"; }

    function addRow(name="", score="") {
        const tbody = document.getElementById('grades-table');
        const row = document.createElement('tr');
        row.innerHTML = `
            <td class="row-index"></td>
            <td><input type="text" class="student-name-input" value="${name}"></td>
            <td><input type="text" class="student-score" style="width:100%; text-align:center; border:none; background:transparent;" value="${score}"></td>
            <td class="btn-remove"><button onclick="this.parentElement.parentElement.remove(); reIndex();" style="color:red; border:none; background:none; cursor:pointer;">X</button></td>
        `;
        tbody.appendChild(row);
        reIndex();
    }

    function reIndex() {
        const rows = document.querySelectorAll('#grades-table tr');
        rows.forEach((row, idx) => { row.querySelector('.row-index').innerText = toAr(idx + 1); });
    }

    function importExcel(e) {
        const reader = new FileReader();
        reader.onload = function(event) {
            const workbook = XLSX.read(new Uint8Array(event.target.result), {type: 'array'});
            const data = XLSX.utils.sheet_to_json(workbook.Sheets[workbook.SheetNames[0]], {header: 1});
            document.getElementById('grades-table').innerHTML = "";
            data.forEach(row => { if(row[0]) addRow(row[0], row[1] || ""); });
        };
        reader.readAsArrayBuffer(e.target.files[0]);
    }

    function sortNames(order) {
        const tbody = document.getElementById('grades-table');
        const rows = Array.from(tbody.querySelectorAll('tr'));
        rows.sort((a, b) => {
            let nameA = a.querySelector('.student-name-input').value;
            let nameB = b.querySelector('.student-name-input').value;
            return order === 'asc' ? nameA.localeCompare(nameB, 'ar') : nameB.localeCompare(nameA, 'ar');
        });
        rows.forEach(row => tbody.appendChild(row));
        reIndex();
    }

    function sortGrades(order) {
        const tbody = document.getElementById('grades-table');
        const rows = Array.from(tbody.querySelectorAll('tr'));
        rows.sort((a, b) => {
            let scoreA = parseFloat(toEn(a.querySelector('.student-score').value)) || 0;
            let scoreB = parseFloat(toEn(b.querySelector('.student-score').value)) || 0;
            return order === 'asc' ? scoreA - scoreB : scoreB - scoreA;
        });
        rows.forEach(row => tbody.appendChild(row));
        reIndex();
    }

    for(let i=0; i<5; i++) addRow();
</script>
</body>
</html>
